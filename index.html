<!DOCTYPE html>
<html>
<head>
    <title>Vehicle COE Visualization</title>
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <style>
        /* Add your CSS styling here */
    </style>
</head>
<body>
    <div id="chart"></div>
    <select id="coeCategory"></select>
    <select id="vehicleType"></select>
    <select id="yearFilter"></select>

    <script src="script.js">
      const parseCoeDate = d3.timeParse("%d-%b");
const formatDate = d3.timeFormat("%Y-%m");

// Load data from both sources
Promise.all([
    d3.csv(coeURL),
    d3.csv(vehicleURL)
]).then(function(files) {
    const coeData = files[0];
    const vehicleData = files[1];

    // Process COE data
    const processedCoeData = coeData.map(d => ({
        date: parseCoeDate(d.Month),
        vehicle_class: d["Vehicle Class"],
        premium: +d.Premium
    })).filter(d => d.date);

    // Process vehicle data
    const processedVehicleData = vehicleData.map(d => ({
        year: new Date(d.year, 0, 1),
        category: d.category,
        type: d.type,
        number: +d.number
    }));

    // Combine and synchronize the data based on date
    const combinedData = synchronizeData(processedCoeData, processedVehicleData);

    // Draw chart
    drawChart(combinedData);
});

function synchronizeData(coeData, vehicleData) {
    // Combine data by synchronizing dates and grouping by year
    return coeData.map(coe => {
        const yearMatch = vehicleData.find(veh => veh.year.getFullYear() === coe.date.getFullYear());
        return {
            date: coe.date,
            premium: coe.premium,
            number: yearMatch ? yearMatch.number : 0
        };
    });
}

function drawChart(data) {
    // Setup scales and axes
    const svg = d3.select("#chart").append("svg").attr("width", 960).attr("height", 500);
    const xScale = d3.scaleTime().range([0, 940]).domain(d3.extent(data, d => d.date));
    const yLeftScale = d3.scaleLinear().range([480, 20]).domain([0, d3.max(data, d => d.premium)]);
    const yRightScale = d3.scaleLinear().range([480, 20]).domain([0, d3.max(data, d => d.number)]);

    // Draw lines
    const premiumLine = d3.line()
        .x(d => xScale(d.date))
        .y(d => yLeftScale(d.premium));
    svg.append("path").datum(data).attr("d", premiumLine).attr("stroke", "blue");

    const vehicleLine = d3.line()
        .x(d => xScale(d.date))
        .y(d => yRightScale(d.number));
    svg.append("path").datum(data).attr("d", vehicleLine).attr("stroke", "red");

    // Add Axes
    svg.append("g").attr("transform", "translate(0,480)").call(d3.axisBottom(xScale));
    svg.append("g").attr("transform", "translate(20,0)").call(d3.axisLeft(yLeftScale));
    svg.append("g").attr("transform", "translate(940,0)").call(d3.axisRight(yRightScale));
}

    </script>
  
</body>
</html>
